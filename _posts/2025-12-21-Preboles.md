---
layout: post
mathjax: true
title:  "Préboles: predictor de arreboles"
---

{% include mathjax.html %}

$\renewcommand{\hat}[1]{\widehat{#1}}$
$\renewcommand{\vec}[1]{\overrightarrow{#1}}$

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Pr%C3%A9boles:-predictor-de-arreboles.">Pr&#233;boles: predictor de arreboles.<a class="anchor-link" href="#Pr%C3%A9boles:-predictor-de-arreboles."></a></h1><p>Pareciera que cualquier paisaje crece en inmensidad al llegar el arrebol. Ese momento en el cual realmente la naturaleza se alinea para revelar colores secretos.</p>
<p>Siempre llamaron mi atención. Había notalidades y colores que no se veían en ningún otros lugares. Nubes rojas como fuego, nubes largas de color naranjo fosforescente, y hastas a veces se veían arcoiris en las nubes producto de la iridiscencia. Siempre quería fotografiarlas y aprendí a leer las nubes.</p>
<p>Con ese conocimiento creé Préboles, versión 1 (21/12/2025)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Modelo-b%C3%A1sico-de-Predicci%C3%B3n-de-arreboles">Modelo b&#225;sico de Predicci&#243;n de arreboles<a class="anchor-link" href="#Modelo-b%C3%A1sico-de-Predicci%C3%B3n-de-arreboles"></a></h3><p>Para describir el arrebol con un modelo probabilistico, primero hay que asumir que el fenómeno arrebol es binario, es decir, puede haber arrebol, o no haber arrebol.</p>
<p>Para que exista un arrebol, hay ciertas variables atmosféricas que deben coincidir desde donde el observador contemplará el fenómeno, como por ejemplo la presencia o falta de algunas nubes o la visibilidad hacia la dirección del sol.</p>
<p>Entonces, necesitamos un estadístico que pueda describir la probabilidad de ocurrencia (ocurre/no ocurre, verdadero/falso, 0/1, etc) de un fenómeno dada la información que tenemos sobre él. Esta es (casi) la definición de una regresión logística. Básicamente es una regresión normal (la suma ponderada de la información disponible), la unidad base de las redes neuronales clásicas. La regresión logística se define de la siguiente forma:</p>
$$
\displaystyle p(\vec{x})={\frac {1}{1+e^{-f(\vec{x}) }}},
$$<p>donde la probabilidad es un numero real, y está contenida en el intervalo $0&lt;p(\vec{x})&lt;1$. La probabilidad depende del vector $\vec{x}=(x_1, x_2, \cdots, x_n)$, el cual contiene la información que hemos recolectado del arrebol, y $f(\vec{x})$ es una función lineal que depende de la información del fenómeno. Si definimos $f(\vec{x})$ de la forma:</p>
$$
f(\vec{x})= \beta_{0}+\beta_{1}x_{1}+\beta_{2}x_{2}+\cdots +\beta_{n}x_{n} = \beta_{0} + \sum_{i=1}^n \beta_{i}x_{i},
$$<p>donde el set de valores $\beta_i =\{ \beta_0,\beta_1,...\beta_n \}$ es un arreglo de $n+1$ pesos o factores ponderantes del vecto de características $\vec{x}$. Considerando notación vectorial:</p>
$$
\Rightarrow f(\vec{x})= \beta_{0} + \vec{\beta}\cdot \vec{x},
$$<p>es decir, si determinamos los $n+1$ parámetros o pesos $\vec{\beta}$, podremos obtener la contribución de cada factor climático (o características) $\vec{x}$ por las cuales ocurre un arrebol. Si tenemos todo lo anterior, una predicción podría ser realizada.</p>
<p>Finalmente, nuestro modelo probabilistico es:</p>
$$
\displaystyle p(\vec{x})=\frac{1}{1+\exp{ \left( -\left( \beta_{0} + \vec{\beta}\cdot \vec{x} \right) \right)}}.
$$<p>¿Cómo obtener el set de valores $\beta_i$? Éstos pueden ser obtenidos a través de métodos de ajustes estádisticos (como míminos cuadrados o métodos de máxima verosimilitud) si tenemos una base de datos con la qué consultar.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Sobre-el-vector-de-caracter%C3%ADsticas">Sobre el vector de caracter&#237;sticas<a class="anchor-link" href="#Sobre-el-vector-de-caracter%C3%ADsticas"></a></h3><p>Una vez establecido el modelo probabilístico básico $p(\vec{x})$, es necesario definir las componentes del vector de características $\vec{x}$ y el método para obtener el valor de predicción $S$ a partir de datos meteorológicos disponibles. En general, las contribuciones de las diferentes variables serán modeladas a traves de una función gaussiana. Los parámetros considerados importantes para la predicción de arreboles son:</p>
<ol>
<li>Porcentaje de cielo cubierto de nubes</li>
</ol>
<p>Hay tres tipos principales de nubes: Nubes bajas, nubes medias y nubes altas. La probabilidad del arrebol es proporcional a la altura de las nubes. Entonces, si llamamos $F_N$ al factor de contribución de las nubes altas $N_{altas}$, las nubes medias $N_{medias}$ y $N_{baja}$, la contribuciòn total de las nubes es de la forma:</p>
$$
F_N = 0.15 \cdot \frac{N_{baja}}{100} + 0.35 \cdot \frac{N_{medias}}{100} + 0.50 \cdot \frac{N_{altas}}{100},
$$<p>donde los factores de nubes se acompañan de un factor ponderante calibrado en base a experiencia y divido 100 para su normalización.</p>
<ol start="2">
<li>Factor geométrico de nubes</li>
</ol>
<p>Las nubes generan el arrebol dada la configuración geométrica de los rayos del sol, al iniciaro o terminar el día. Existen distinciones bien definidas para la altura del sol luego del amanecer/atardecer, ambos se diferencian en el ángulo de inclinación del sol con respecto al horizonte visible: existe el &quot;crepúsculo civil&quot; ($-6^\circ&lt;\theta&lt;0^\circ$) y el &quot;crepúsculo nautico&quot; ($-12^\circ&lt;\theta&lt;-6^\circ$). Para determinar la contribución $F_{\theta}$ del factor geométrico, podemos modelar la dependencia del arrebol con el ángulo $\theta$ de inclinación del sol mediante una función de decaimiento gaussiano:
$$
F_{\theta} = \exp\left[-\left(\dfrac{ -|\theta|- \theta_{ideal}}{\sigma_\theta}\right)^2\right],
$$</p>
<p>donde $\theta_{ideal}$ es el ángulo más probable que produzca arrebol, lo consideraremos como $\theta_{ideal}=-3^\circ$, que es el punto medio del crepusculo civil, y $\sigma_\theta = 4^\circ$, el cual integra el intervalo. Este factor geométrico actua como un &quot;interruptor&quot; o filtro para que no exista probabilidad de arrebol en configuraciones donde físicamente no es posible.</p>
<ol start="3">
<li>Calidad del aire</li>
</ol>
<p>La calidad del aire afecta la coloración de las nubes durante el arrebol. Dependiendo del tamaño promedio de las particulas y su abundancia en la atmósfera, es esperable que predominen ciertos colores. Particularmente, se monitorean la presencia de partículas con diámetro promedio de 2.5 micrometros (o PM$_{2.5}$). Si consideramos un valor &quot;optimo&quot; para el arrebol (optimo para los colores, no para el ser humano), tenemos que $PM_{2.5}^{ideal} = 15 \frac{\mu g}{m^3}$, con $\sigma_{PM}=18\frac{\mu g}{m^3}$ podemos usar la misma lógica anterior, la contribución de la calidad del aire será:</p>
$$
F_{PM_{2.5}} = \exp\left[-\left(\frac{PM_{2.5} - PM_{2.5}^{ideal}}{\sigma_{PM}}\right)^2\right]
$$<p>Si no existe material particulado, no hay contribución.</p>
<ol start="4">
<li>Dispersión de Rayleigh y la presión Atmosférica</li>
</ol>
<p>La presión atmosférica afecta la dispersión de la luz, modificando la densidad del aire (mayor presión, mayor densidad de particulas para dispersar luz). También, los sistemas de alta presión tienden a tener cielos más despejados con nubes altas y delgadas.</p>
<p>La intensidad de dispersión Rayleigh $I_R$ para una longitud de onda $\lambda$ está dada por:</p>
$$
I_R(\lambda) = I_0 \cdot \frac{8\pi^4 \alpha^2}{\lambda^4 R^2} \cdot (1 + \cos^2\theta) \cdot \frac{\rho}{\rho_0},
$$<p>donde $I_0$ es la intensidad de la luz solar, $\alpha = \frac{n^2 - 1}{n^2 + 2}$ es la posible polarización molecular, $n$ el índice de refracción del aire, $\lambda$ es la longuitud de onda, $R$ la distancia al observador, $\theta$ es el ángulo de dispersión, y $\rho$ es la densidad atmosférica. Varios de los parámetros presentes en la expresión pueden considerarse aproximadamente constantes ($\lambda$ pertenece siempre al rango visible, $n$ y $\theta$ presentan variaciones pequeñas) bajo condiciones atmosféricas normales. Además, si asumimos que $\rho \sim P$, la contribución de la dispersión de Rayleigh puede resepresntarse como una ley de potencias de la forma:</p>
$$
F_{Rayleigh} = \left( \frac{P}{P_0} \right) ^\gamma,
$$<p>donde $P_0 = 1013hPa$ (hectopascal) es la presión de referencia a nivel del mar, y $\gamma$ es considerado la unidad.</p>
<ol start="5">
<li>Humedad</li>
</ol>
<p>En condiciones de humedad baja, las partículas permanecen pequeñas y la dispersión es limitada, lo que suele producir colores más duros y menos extendidos. A medida que la humedad aumenta, las partículas absorben vapor de agua, crecen en tamaño y dispersan la luz roja a mayor tasa, generando arreboles más suaves, saturados y extensos. No obstante, cuando la humedad es excesivamente alta, la dispersión múltiple y la absorción reducen el contraste, produciendo cielos lechosos o apagados. Por eso, la contribución de la humedad es modelada por una gaussiana de la forma:</p>
$$
F_H = \exp\left[-\left(\frac{H - H^{ideal}}{\sigma_{H}}\right)^2\right],
$$<p>donde $H^{ideal}$ es la humedad relativa del 60%, y $\sigma_H = 20$%</p>
<p>El vector $\vec{x}$ se construye como una combinación lineal ponderada de $n=5$ factores atmosféricos básicos discutidos anteriormente, cada uno normalizado al intervalo $[0,1]$.</p>
$$
\vec{x} = (F_N, F_{\theta}, F_{PM_{2.5}}, F_{Rayleigh}, F_H)
$$<p>donde cada $F_j$ representa un índice que cuantifica la condición favorable para un arrebol. La función lineal $f(\vec{x})$ que alimenta la logística se expresa entonces como:</p>
$$
f(\vec{x}) = \beta_0 + \beta_1 F_N + \beta_2 F_{\theta} + \beta_3 F_{PM_{2.5}} + \beta_4 F_{Rayleigh} + \beta_5 F_H
$$<p>Para este modelo operativo, los pesos $\vec{\beta}$ se han calibrado empíricamente con la observaciòn y con datos históricos (Haciendo), resultando en la siguiente asignación de importancia relativa para la primera versión de Préboles</p>
<p><strong>Pesos de los Factores:</strong></p>
<table>
<thead>
<tr>
  <th style="text-align:left">Factor</th>
  <th style="text-align:left">Símbolo</th>
  <th style="text-align:center">Peso</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left">Nubosidad por capas</td>
  <td style="text-align:left">$F_N$</td>
  <td style="text-align:center">50%</td>
</tr>
<tr>
  <td style="text-align:left">Geometría solar</td>
  <td style="text-align:left">$F_{\theta}$</td>
  <td style="text-align:center">20%</td>
</tr>
<tr>
  <td style="text-align:left">Calidad del aire</td>
  <td style="text-align:left">$F_{PM_{2.5}}$</td>
  <td style="text-align:center">10%</td>
</tr>
<tr>
  <td style="text-align:left">Presión/Rayleigh</td>
  <td style="text-align:left">$F_{Rayleigh}$</td>
  <td style="text-align:center">10%</td>
</tr>
<tr>
  <td style="text-align:left">Humedad atmosférica</td>
  <td style="text-align:left">$F_H$</td>
  <td style="text-align:center">10%</td>
</tr>
</tbody>
</table>
<p>El término $\beta_0$ actúa como un umbral de calibración general.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Sobre-los-datos">Sobre los datos<a class="anchor-link" href="#Sobre-los-datos"></a></h3><ol>
<li>Open-meteo (<a href="https://open-meteo.com/">https://open-meteo.com/</a>):</li>
</ol>
<p>Open-meteo es una base de datos libre que recolecta información meteorológica desde diferentes fuentes, donde dichas variables atmosféricas pueden ser accedidas dadas las coordenadas del planeta en donde querramos consultar. Particularmente, ofrece una grilla de datos de $11\times11$ $km^2$ donde recolecta datos en tiempo real, y también ofrece una predicción de las mismas variables en un futuro cercano. Entre otras variables, Open-meteo ofrece información sobre la distribución de las nubes (altas, medias, bajas), presión atmosférica, temperatura y otros datos (también históricos) que podrían ser relevantes.</p>
<ol start="2">
<li>Calidad del Aire:</li>
</ol>
<p>Es sabido que la intensidad del color del arrebol es proporcional a la cantidad de material particulado presente en la atmósfera. El sitio OpenAQ (<a href="https://openaq.org/">https://openaq.org/</a>) proporcina valores de la calidad del aire, a través de reportar la cantidad materia particulada fina en el aire, las cuales tienen un diámetro de 2.5 micrómetros o menos, esto es lo que se conoce como PM2.5.</p>
<ol start="3">
<li>Configuración geométrica del arrebol:</li>
</ol>
<p>Básicamente el arrebol se genera porque los rayos del sol rebotan en las nubes y llegan hasta nuestros ojos. Es necesario tener en cuenta la geometría de la posición del sol y de las nubes para tener en cuenta la hora</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Sobre-la-visualizaci%C3%B3n-de-datos">Sobre la visualizaci&#243;n de datos<a class="anchor-link" href="#Sobre-la-visualizaci%C3%B3n-de-datos"></a></h3><p>Con todo lo anterior, se realiza la predicción del arrebol para diferentes ciudades y observatorios de Chile.</p>
<ol>
<li><p>Mapa de probabilidad: Se utiliza como base la grilla de open-meteo, y luego se teselan hexágonos alrededor de la ciudad para mostrar la probabilidad que, desde allí, se pueda ver el arrebol tanto para el amanecer, como para el atardecer.</p>
</li>
<li><p>Series de tiempo de nubes: Como el modelo pondera fuertemente la presencia de nubes, las series de tiempo de porcentaje de nubes bajas, medias y altas son mostradas como referencia. También se agregan los momentos cuando ocurre el amanecer, el atardecer y la hora actual.</p>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Validaci%C3%B3n-y-Mejoras-Futuras">Validaci&#243;n y Mejoras Futuras<a class="anchor-link" href="#Validaci%C3%B3n-y-Mejoras-Futuras"></a></h3><ul>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Redes sociales y reportes diarios.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Agregar Observatorios en Chile.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Calcular explícitamente a qué hora ocurre el arrebol.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Crear base de datos historica.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Entrenar el modelo basándose en usuarios.</li>
<li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox" disabled/>Agregar más ciudades.</li>
</ul>

</div>
</div>
</div>


